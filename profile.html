<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-70VSGR5WBW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-70VSGR5WBW');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Vendor Profile - AFIT Market</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="asset/style.css">
  
  <link rel="icon" href="img/app-logo.png" type="image/png" sizes="192x192">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
      /* Hide content until loaded */
      #profile-content { display: none; }
      
      /* Status Colors */
      .status-open { background: #e6fffa !important; color: #00b894 !important; border: 1px solid #00b894; }
      .status-closed { background: #fff5f5 !important; color: #d63031 !important; border: 1px solid #d63031; }

      /* LOAD MORE BUTTON STYLE */
      #load-more-btn {
          display: block;
          margin: 30px auto;
          background: #333;
          color: white;
          border: none;
          padding: 12px 30px;
          border-radius: 30px;
          font-weight: bold;
          cursor: pointer;
          transition: transform 0.2s, background 0.2s;
          box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      }
      #load-more-btn:active { transform: scale(0.95); }
      #load-more-container { text-align: center; width: 100%; margin-bottom: 40px; }

      /* --- üÜï TEXT & MODAL STYLES --- */
      .ad-title {
          white-space: normal !important;
          line-height: 1.3;
          height: auto !important;
          display: -webkit-box;
          -webkit-line-clamp: 2;
          -webkit-box-orient: vertical;
          overflow: hidden;
          margin-bottom: 5px;
      }
      .ad-desc-preview {
          font-size: 11px; color: #888;
          white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
          margin-bottom: 8px;
      }

      @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
      .modal-sheet {
          background: white; width: 100%; max-width: 500px;
          border-radius: 20px 20px 0 0; padding: 25px;
          animation: slideUp 0.3s ease-out;
          position: relative;
      }

      /* --- SKELETON LOADING STYLES --- */
      .skeleton-pulse {
          animation: skeleton-loading 1.5s infinite ease-in-out;
          background-color: #eee;
          background-image: linear-gradient(90deg, #eee, #f5f5f5, #eee);
          background-size: 200px 100%;
          background-repeat: no-repeat;
          border-radius: 4px;
          color: transparent !important;
      }

      @keyframes skeleton-loading {
          0% { background-position: -200px 0; }
          100% { background-position: calc(200px + 100%) 0; }
      }

      /* Profile Skeleton Specifics */
      .sk-container {
          padding: 20px;
          background: #fff;
          border-radius: 15px;
          box-shadow: 0 5px 15px rgba(0,0,0,0.05);
          text-align: center;
          margin-bottom: 20px;
      }
      .sk-avatar { width: 100px; height: 100px; border-radius: 50%; margin: 0 auto 15px; }
      .sk-title { width: 60%; height: 24px; margin: 0 auto 10px; }
      .sk-badge { width: 80px; height: 15px; margin: 0 auto 20px; border-radius: 10px; }
      .sk-line { width: 90%; height: 12px; margin: 8px auto; }
      .sk-line-short { width: 50%; height: 12px; margin: 8px auto; }
      
      .sk-btn-lg { width: 80%; max-width: 240px; height: 45px; margin: 25px auto 10px; border-radius: 30px; }
      .sk-btn-sm { width: 135px; height: 40px; margin: 10px auto; border-radius: 30px; }
      
      /* Product Card Skeleton */
      .skeleton-card {
          background: #fff;
          border-radius: 10px;
          padding: 10px;
          box-shadow: 0 2px 10px rgba(0,0,0,0.05);
          display: flex;
          flex-direction: column;
          gap: 8px;
          height: 220px;
      }
      .sk-img-rect { width: 100%; height: 120px; border-radius: 8px; background: #eee; animation: skeleton-loading 1.5s infinite linear; }
      .sk-text-short { width: 40%; height: 15px; background: #eee; border-radius: 4px; animation: skeleton-loading 1.5s infinite linear; }
      .sk-text-long { width: 90%; height: 15px; background: #eee; border-radius: 4px; animation: skeleton-loading 1.5s infinite linear; }
      .sk-btn { width: 100%; height: 30px; margin-top: auto; background: #eee; border-radius: 6px; animation: skeleton-loading 1.5s infinite linear; }

      /* --- DARK MODE FIXES --- */
      body.dark-mode .sk-container,
      body.dark-mode .skeleton-card {
          background: #222; border: 1px solid #333; box-shadow: none;
      }
      body.dark-mode .skeleton-pulse,
      body.dark-mode .sk-img-rect,
      body.dark-mode .sk-text-short,
      body.dark-mode .sk-text-long,
      body.dark-mode .sk-btn,
      body.dark-mode #load-more-btn {
          background-color: #333;
          background-image: linear-gradient(90deg, #333, #444, #333);
      }
      body.dark-mode .modal-sheet { background: #1e1e1e !important; color: white; }
      body.dark-mode .ad-desc-preview { color: #aaa; }
      body.dark-mode #m-desc { color: #ccc !important; }
  </style>
</head>
<body data-page="vendor-profile">

  <script>
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark-mode');
    }
  </script>

  <div class="app-container">
    
    <div class="header">
      <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
      <span style="font-weight:bold;">Store Profile</span>
    </div>

    <div id="profile-skeleton">
        <div class="sk-container">
            <div class="skeleton-pulse sk-avatar"></div>
            <div class="skeleton-pulse sk-title"></div>
            <div class="skeleton-pulse sk-badge"></div>
            <div class="skeleton-pulse sk-line"></div>
            <div class="skeleton-pulse sk-line"></div>
            <div class="skeleton-pulse sk-line-short"></div>
            
            <div class="skeleton-pulse sk-line-short" style="margin-top: 15px;"></div>

            <div class="skeleton-pulse sk-btn-sm"></div>
            <div style="display:flex; justify-content:center; gap:20px; margin-top:10px;">
                <div class="skeleton-pulse" style="width:30px; height:30px; border-radius:50%;"></div>
                <div class="skeleton-pulse" style="width:30px; height:30px; border-radius:50%;"></div>
            </div>
            
            <div class="skeleton-pulse sk-line" style="margin-top:20px;"></div>
        </div>
        
        <div class="skeleton-pulse sk-title" style="margin-left: 20px; margin-bottom: 15px; width: 40%;"></div>
        
        <div class="trending-grid">
            <div class="skeleton-card"><div class="sk-img-rect"></div><div class="sk-text-short"></div><div class="sk-text-long"></div><div class="sk-btn"></div></div>
            <div class="skeleton-card"><div class="sk-img-rect"></div><div class="sk-text-short"></div><div class="sk-text-long"></div><div class="sk-btn"></div></div>
            <div class="skeleton-card"><div class="sk-img-rect"></div><div class="sk-text-short"></div><div class="sk-text-long"></div><div class="sk-btn"></div></div>
            <div class="skeleton-card"><div class="sk-img-rect"></div><div class="sk-text-short"></div><div class="sk-text-long"></div><div class="sk-btn"></div></div>
        </div>
    </div>

    <div id="profile-content">
        <section class="profile-section">
            <img id="p-img" src="img/person.png" alt="Vendor Logo" class="profile-img">
            
            <div class="business-name">
                <span id="p-name"></span> 
                <span id="p-badge"></span>
            </div>
            
            <div style="margin-bottom: 8px;">
                <span id="p-id" style="background:#eee; color:#555; font-size:10px; padding:2px 8px; border-radius:10px; font-family:monospace; font-weight:bold;">
                ID: ...
                </span>
            </div>

            <p id="p-desc" class="business-description">
                </p>

            <div style="font-size: 12px; color: #555; margin: 10px 0; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <span><i class="far fa-clock" style="color:#2d8eff;"></i> <span id="p-hours">Checking...</span></span>
                <span id="shop-status" style="font-weight: bold; font-size: 11px; padding: 2px 8px; border-radius: 10px; background: #eee; color: #777;">
                    ...
                </span>
            </div>

            <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 12px; align-items: center;">
                
                <button id="btn-manage" onclick="window.location.href='dashboard.html'" 
                    style="display:none; width: 100%; max-width: 240px; background: #6c5ce7; color: white; border: none; padding: 12px; border-radius: 30px; font-weight: bold; font-size: 14px; cursor: pointer; box-shadow: 0 4px 10px rgba(108, 92, 231, 0.3);">
                    <i class="fas fa-store"></i> Manage My Shop
                </button>

                <a id="btn-contact" href="#" class="chat-btn" 
                   style="width: 100%; max-width: 135px; background: #25D366; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 14px; font-weight: bold;">
                    <i class="fab fa-whatsapp"></i> Contact Shop
                </a>

                <div style="display: flex; gap: 20px; margin-top: 5px;">
                    <a id="link-phone" href="#" style="color:#333;"><i class="fas fa-phone-alt fa-lg"></i></a>
                    <a id="link-insta" href="#" style="color:#E1306C; display:none;"><i class="fab fa-instagram fa-lg"></i></a>
                    <button onclick="shareVendor()" style="background:none; border:none; color:#2d8eff; cursor:pointer; font-size: 16px;"><i class="fas fa-share-alt"></i></button>
                </div>
            </div>

            <div class="business-meta" style="margin-top: 20px;">
                <span><i class="fas fa-map-marker-alt"></i> <span id="p-location">Location</span></span>
                <span><i class="fas fa-user-shield"></i> Joined: <span id="p-date">2026</span></span>
            </div>
            
            <div style="margin-top: 15px; display: flex; gap: 20px; justify-content: center;">
                <a href="reviews/" style="color: #2d8eff; font-size: 12px; text-decoration: none; font-weight: 600;">
                    <i class="far fa-star"></i> Drop a Review
                </a>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSfy6SsEKGXykaneoLbGFatxtmAMgsemonogQaGqkFK-B9mxuA/viewform?usp=header" style="color: #d9534f; font-size: 12px; text-decoration: none;">
                    <i class="fas fa-flag"></i> Report Vendor
                </a>
            </div>
        </section>

        <h2 class="products-title">Items from this Store</h2>
        
        <div class="trending-grid" id="vendor-grid">
            </div>

        <div id="load-more-container" style="display: none;">
            <button id="load-more-btn" onclick="renderBatch()">Load More</button>
        </div>
    </div>

    <div id="detail-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:3000; justify-content:center; align-items:end;">
        <div class="modal-sheet">
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <h3 id="m-title" style="margin:0; font-size:18px; width:90%; line-height:1.3;">...</h3>
                <button onclick="document.getElementById('detail-modal').style.display='none'" style="background:none; border:none; font-size:24px; color:#555; cursor:pointer;">&times;</button>
            </div>
            <p id="m-price" style="color:#2d8eff; font-weight:bold; font-size:20px; margin:10px 0;">...</p>
            
            <div style="max-height:200px; overflow-y:auto; margin-bottom:20px; background:#f9f9f9; padding:10px; border-radius:10px;">
                 <p id="m-desc" style="color:#555; font-size:14px; line-height:1.5; margin:0;">...</p>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                 <span id="m-category" style="font-size:12px; color:#888; font-weight:bold;"></span>
            </div>

            <a id="m-btn" href="#" target="_blank" class="chat-btn" style="width:100%; text-align:center; display:block; padding:15px; border-radius:10px;">
                <i class="fab fa-whatsapp"></i> Chat with Vendor
            </a>
        </div>
    </div>

    <div id="error-message" style="display:none; text-align:center; padding:50px;">
        <i class="fas fa-exclamation-circle" style="font-size:40px; color:#ccc;"></i>
        <h3 style="margin-top:10px; color:#555;">Vendor Not Found</h3>
        <p style="color:#888;">This vendor ID does not exist.</p>
        <a href="index.html" class="chat-btn" style="display:inline-block; margin-top:10px; background:#2d8eff;">Go Home</a>
    </div>

    <footer class="site-footer">
        <p style="margin-top:20px; color:#777; font-size: 12px;">
    &copy; 2026 All rights reserved. Powered by 
    <a href="https://brightsitedev.tech" target="_blank" style="color:#2d8eff; text-decoration:none; font-weight:bold;">Brightsitedev</a>
</p>
    </footer>
  </div>

  <script src="asset/script.js"></script>

  <script>
    // --- SUPABASE CONFIG ---
    const supabaseUrl = "https://mofdxngxakijeokaylwt.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1vZmR4bmd4YWtpamVva2F5bHd0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkyNzYyMjAsImV4cCI6MjA4NDg1MjIyMH0.PqyNGp7Yp01ScCMDr4ta6GQPVqxa6A476Lz9cYKj3dE";
    
    // Use 'sbClient' to prevent conflicts
    const sbClient = window.supabase.createClient(supabaseUrl, supabaseKey);

    // Global Vars
    let savedItemIds = new Set();
    let currentVendorPhone = "";
    let activeUser = null;
    let vendorEmail = "";
    
    // Pagination
    let allVendorProducts = []; 
    let currentProductIndex = 0; 
    const BATCH_SIZE = 16; 

    // --- INITIALIZATION ---
    document.addEventListener("DOMContentLoaded", async () => {
        window.renderBatch = renderBatch;

        // 1. GET USER
        const localData = localStorage.getItem('user_data');
        if(localData) {
            activeUser = JSON.parse(localData);
            loadSavedItems();
        } else {
            const { data: { user } } = await sbClient.auth.getUser();
            if(user) {
                activeUser = user;
                loadSavedItems();
            }
        }

        // 2. GET VENDOR ID FROM URL
        const params = new URLSearchParams(window.location.search);
        let vendorDisplayID = params.get('vendor');
        
        if(vendorDisplayID) {
            vendorDisplayID = vendorDisplayID.trim();
            loadProfile(vendorDisplayID);
        } else {
            showError("Missing Vendor ID", "The link is broken. No ID found.");
        }
    });

    // --- FETCH PROFILE ---
    async function loadProfile(displayId) {
        try {
            // Get Vendor from Supabase 'vendors' table using custom ID (e.g. V001)
            const { data: vendor, error } = await sbClient
                .from('vendors')
                .select('*')
                .eq('vendor_unique_id', displayId) // Use the column name we set in SQL
                .single();

            if(error || !vendor) {
                showError("Vendor Not Found", `ID "${displayId}" does not exist.`);
                return;
            }

            // Check if suspended
            if (!vendor.is_approved) {
               showError("Pending Approval", "This profile is currently inactive.");
               return;
            }

            // Render
            renderVendor(vendor);
            
            // Check Ownership (Show Manage Button)
            if (activeUser && activeUser.email === vendor.email) {
                document.getElementById('btn-manage').style.display = 'block';
            }

            // Load Products using the UUID
            loadProducts(vendor.id); 

        } catch (err) {
            console.error(err);
            showError("Connection Error", "Could not load vendor profile.");
        }
    }

    function renderVendor(v) {
        document.title = `${v.business_name} - Profile`;
        document.getElementById('p-name').innerText = v.business_name;
        document.getElementById('p-id').innerText = `ID: ${v.vendor_unique_id}`;
        document.getElementById('p-desc').innerText = v.description || "No description available.";
        document.getElementById('p-location').innerText = v.location || "AFIT Campus";
        // Convert timestamp to year
        const date = new Date(v.created_at);
        document.getElementById('p-date').innerText = date.getFullYear();
        
        let imgSrc = v.logo_url || "img/person.png";
        document.getElementById('p-img').src = imgSrc;
        
        const phone = v.phone_number || "";
        currentVendorPhone = String(phone).replace(/[^0-9]/g, '');
        
        document.getElementById('link-phone').href = `tel:${phone}`;
        document.getElementById('btn-contact').href = `https://wa.me/${currentVendorPhone}`;
        
        const instaLink = v.instagram_handle;
        if(instaLink) { 
            const insta = document.getElementById('link-insta'); 
            insta.href = `https://instagram.com/${instaLink.replace('@','')}`; 
            insta.style.display = 'inline-block'; 
        }
        
        // Badge logic (Assuming you add a 'verified_level' column later, or just is_approved)
        if (v.is_approved) document.getElementById('p-badge').innerHTML = '<i class="fas fa-check-circle tick-blue"></i>';
        
        // Status Logic
        const is247 = v.online_247;
        const statusBadge = document.getElementById('shop-status');
        const hoursText = document.getElementById('p-hours');
        
        if (is247) {
            hoursText.innerText = "Digital Service (24/7)"; 
            statusBadge.innerText = "üü¢ Online 24/7"; 
            statusBadge.className = "status-open";
        } else {
            // Default times if missing
            const openTime = v.open_time ? parseInt(v.open_time.split(':')[0]) : 9;
            const closeTime = v.close_time ? parseInt(v.close_time.split(':')[0]) : 21;
            
            const formatTime = (t) => { if(t === 12) return "12pm"; if(t === 24 || t === 0) return "12am"; return t > 12 ? (t - 12) + "pm" : t + "am"; };
            
            hoursText.innerText = `Mon - Sat: ${formatTime(openTime)} - ${formatTime(closeTime)}`;
            
            const now = new Date(); 
            const currentHour = now.getHours(); 
            const currentDay = now.getDay(); 
            
            if (currentDay === 0) { statusBadge.innerText = "üî¥ Closed (Sunday)"; statusBadge.className = "status-closed"; }
            else if (currentHour >= openTime && currentHour < closeTime) { statusBadge.innerText = "üü¢ Open Now"; statusBadge.className = "status-open"; }
            else { statusBadge.innerText = "üî¥ Closed Now"; statusBadge.className = "status-closed"; }
        }

        // Show Content
        document.getElementById('profile-skeleton').style.display = 'none';
        document.getElementById('profile-content').style.display = 'block';
    }

    // --- FETCH PRODUCTS ---
    async function loadProducts(vendorUUID) {
        try {
            const { data: products, error } = await sbClient
                .from('products')
                .select('*')
                .eq('vendor_id', vendorUUID) // Use the UUID to find products
                .order('created_at', { ascending: false });

            if(error) throw error;

            allVendorProducts = products;
            const grid = document.getElementById('vendor-grid');
            grid.innerHTML = ""; 

            if(allVendorProducts.length === 0) { 
                grid.innerHTML = "<p style='width:100%; text-align:center; padding:20px; color:#777;'>No items listed yet.</p>"; 
                document.getElementById('load-more-container').style.display = 'none';
                return; 
            }
            
            renderBatch();

        } catch (err) {
            console.error("Products Error:", err);
        }
    }

    function renderBatch() {
        const grid = document.getElementById('vendor-grid');
        const loadMoreContainer = document.getElementById('load-more-container');
        const loadMoreBtn = document.getElementById('load-more-btn');

        const nextIndex = currentProductIndex + BATCH_SIZE;
        const productsToShow = allVendorProducts.slice(currentProductIndex, nextIndex);

        productsToShow.forEach(p => {
            const isSold = p.is_sold;
            const isFeatured = p.is_flash_sale;
            
            const pID = p.id;
            const pName = p.title;
            const pPrice = "‚Ç¶" + Number(p.price).toLocaleString();
            const img = p.image_url;
            const pDesc = p.description || "No description.";
            
            // Save Status
            const isSaved = savedItemIds.has(pID); 
            const heartClass = isSaved ? 'fas' : 'far'; 
            const heartColor = isSaved ? '#ff4757' : '#777';

            const opacity = isSold ? 'opacity:0.6;' : '';
            let badge = '';
            if (isSold) badge = '<span style="background:red; color:white; font-size:9px; padding:2px 5px; position:absolute; top:10px; left:10px; border-radius:4px; z-index:10;">SOLD</span>';
            else if (isFeatured) badge = '<span style="background:#f1c40f; color:white; font-size:9px; padding:2px 5px; position:absolute; top:10px; left:10px; border-radius:4px; z-index:10; font-weight:bold;">‚≠ê Sponsored</span>';

            const safeName = pName.replace(/'/g, "\\'").replace(/"/g, "&quot;");
            const safeDesc = pDesc.replace(/'/g, "\\'").replace(/"/g, "&quot;").replace(/\n/g, " ");

            const btnText = isSold ? "Sold" : "Get Item";
            const btnStyle = isSold ? "background:#777; pointer-events:none;" : "";
            const btnAction = isSold ? "" : `openDetailModal('${safeName}', '${pPrice}', '${safeDesc}', '${p.category}')`;

            grid.innerHTML += `
            <div class="ad-card" style="position:relative; ${opacity}">
                ${badge}
                <button onclick="toggleSave('${pID}')" class="save-btn" id="save-${pID}" 
                    style="position:absolute; top:10px; right:10px; background:white; border:none; border-radius:50%; width:30px; height:30px; display:flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:10;">
                    <i class="${heartClass} fa-heart" style="color:${heartColor}; font-size:16px;"></i>
                </button>
                
                <img class="ad-img" src="${img}" alt="${safeName}" onerror="this.src='img/logo-blue.png'">
                
                <div class="ad-info">
                    <div class="ad-price">${pPrice}</div>
                    <div class="ad-title">${pName}</div>
                    <div class="ad-desc-preview">${pDesc.substring(0, 40)}...</div>
                    <button onclick="${btnAction}" class="chat-btn" style="width:100%; margin-top:5px; border:none; cursor:pointer; ${btnStyle}">${btnText}</button>
                </div>
            </div>`;
        });

        currentProductIndex = nextIndex;

        if (currentProductIndex >= allVendorProducts.length) {
            loadMoreContainer.style.display = 'none'; 
        } else {
            loadMoreContainer.style.display = 'block'; 
            loadMoreBtn.innerText = "Load More"; 
        }
    }

    // --- UTILS ---
    window.openDetailModal = function(title, price, desc, category) {
        document.getElementById('m-title').innerText = title;
        document.getElementById('m-price').innerText = price;
        document.getElementById('m-desc').innerText = desc;
        document.getElementById('m-category').innerText = "Category: " + category;
        
        const waMsg = encodeURIComponent(`Hi, I saw "${title}" on AFIT Market (Price: ${price}). Is it available?`);
        document.getElementById('m-btn').href = `https://wa.me/${currentVendorPhone}?text=${waMsg}`;
        
        document.getElementById('detail-modal').style.display = 'flex';
    };

    window.toggleSave = async function(pid) {
        if (!activeUser) { 
            if(confirm("Sign in to save items?")) window.location.href = "login.html"; 
            return; 
        }
        
        const btnIcon = document.querySelector(`#save-${pid} i`);
        
        if (savedItemIds.has(pid)) {
            // Remove
            savedItemIds.delete(pid);
            btnIcon.classList.replace('fas', 'far'); btnIcon.style.color = '#777';
            await sbClient.from('saved_items').delete().eq('user_id', activeUser.id).eq('product_id', pid);
        } else {
            // Add
            savedItemIds.add(pid);
            btnIcon.classList.replace('far', 'fas'); btnIcon.style.color = '#ff4757';
            await sbClient.from('saved_items').insert({ user_id: activeUser.id, product_id: pid });
        }
    };

    async function loadSavedItems() {
        if(!activeUser) return;
        const { data } = await sbClient.from('saved_items').select('product_id').eq('user_id', activeUser.id);
        if(data) data.forEach(item => savedItemIds.add(item.product_id));
        updateHeartIcons();
    }

    function updateHeartIcons() {
        document.querySelectorAll('.save-btn').forEach(btn => {
            const id = btn.id.replace('save-', '');
            const icon = btn.querySelector('i');
            if (savedItemIds.has(id)) {
                icon.classList.replace('far', 'fas'); icon.style.color = '#ff4757';
            }
        });
    }

    function showError(title, msg) {
        document.getElementById('profile-skeleton').style.display = 'none'; 
        const errorBox = document.getElementById('error-message');
        errorBox.style.display = 'block';
        errorBox.querySelector('h3').innerText = title;
        errorBox.querySelector('p').innerText = msg;
    }
    
    window.shareVendor = function() {
        if (navigator.share) { navigator.share({ title: document.title, url: window.location.href }); } else { alert("Link copied!"); }
    }
  </script>
</body>
</html>