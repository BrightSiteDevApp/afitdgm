<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - AFIT Digital Market</title>
    
    <link rel="stylesheet" href="asset/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="img/app-logo.png" type="image/png" sizes="192x192">
    <link rel="apple-touch-icon" href="img/app-logo.png">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <style>
        body { background: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        
        .login-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 85vh;
            padding: 20px;
        }

        /* --- LOGIN CARD --- */
        .card-box {
            background: white;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            text-align: center;
            max-width: 400px;
            width: 100%;
            transition: transform 0.3s ease;
        }
        
        .welcome-title { font-size: 24px; font-weight: 800; color: #2d8eff; margin-bottom: 10px; }
        .welcome-text { color: #666; font-size: 14px; line-height: 1.6; margin-bottom: 30px; }

        .google-btn {
            background: white; color: #333; border: 1px solid #ddd;
            padding: 14px 20px; border-radius: 30px; font-weight: 600; font-size: 15px;
            display: flex; align-items: center; justify-content: center; gap: 15px;
            cursor: pointer; width: 100%; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .google-btn:hover { box-shadow: 0 6px 15px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .google-btn:active { transform: scale(0.98); }

        /* --- USER DASHBOARD (AFTER LOGIN) --- */
        .user-area { display: none; width: 100%; max-width: 450px; }
        
        .profile-header {
            background: white; padding: 25px; border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); text-align: center;
            margin-bottom: 20px; position: relative; overflow: hidden;
        }
        .profile-header::before {
            content: ""; position: absolute; top:0; left:0; width:100%; height:80px;
            background: linear-gradient(135deg, #2d8eff, #6c5ce7); z-index: 0;
        }
        .user-img {
            width: 90px; height: 90px; border-radius: 50%; border: 4px solid white;
            object-fit: cover; position: relative; z-index: 1; margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .user-name { font-size: 20px; font-weight: bold; margin-top: 10px; color: #333; position: relative; z-index: 1; }
        .user-email { font-size: 13px; color: #777; margin-bottom: 5px; position: relative; z-index: 1; }

        /* Quick Actions Grid */
        .action-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        .action-card {
            background: white; padding: 20px; border-radius: 15px; text-align: center;
            text-decoration: none; color: #333; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s; border: 1px solid transparent;
        }
        .action-card:active { transform: scale(0.96); }
        .action-icon {
            font-size: 24px; margin-bottom: 10px; color: #2d8eff;
            background: #eef7ff; width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;
        }
        .action-title { font-size: 14px; font-weight: 600; }

        .logout-btn {
            background: #fff5f6; color: #ff4757; border: 1px solid #ff4757;
            padding: 12px; border-radius: 30px; width: 100%; font-weight: bold;
            margin-top: 25px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">
            <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
            <span style="font-weight:bold;">My Account</span>
        </div>

        <div class="login-wrapper">
            
            <div id="login-view" class="card-box">
                <img src="img/logo-blue.png" style="width: 70px; margin-bottom: 15px;">
                <h2 class="welcome-title">Welcome Back!</h2>
                <p class="welcome-text">
                    Join AFIT Digital Market to save items, chat with vendors, and post requests.
                </p>

                <button id="btn-login" class="google-btn">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="22" alt="Google">
                    Sign in with Google
                </button>
                <div style="margin-top:20px; font-size:12px; color:#aaa;">Secure login powered by Google</div>
            </div>

            <div id="user-area" class="user-area">
                
                <div class="profile-header">
                    <img id="user-pic" class="user-img" src="" alt="Profile">
                    <h3 id="user-name" class="user-name"></h3>
                    <p id="user-email" class="user-email"></p>
                    <div style="font-size:11px; color:#2d8eff; font-weight:bold; margin-top:5px;">‚óè Active</div>
                </div>

                <h4 style="margin: 0 0 15px 5px; color:#555;">What would you like to do?</h4>

                <div class="action-grid">
                    <a href="index.html" class="action-card">
                        <div class="action-icon"><i class="fas fa-home"></i></div>
                        <div class="action-title">Go Home</div>
                    </a>
                    <a href="vendors/" class="action-card">
                        <div class="action-icon" style="color:#9c27b0; background:#f3e5f5;"><i class="fas fa-store"></i></div>
                        <div class="action-title">Browse Shops</div>
                    </a>
                    <a href="saved.html" class="action-card">
                        <div class="action-icon" style="color:#ff4757; background:#fff5f6;"><i class="fas fa-heart"></i></div>
                        <div class="action-title">Saved Items</div>
                    </a>
                    <a href="requests.html" class="action-card">
                        <div class="action-icon" style="color:#ffa502; background:#fff8e1;"><i class="fas fa-bullhorn"></i></div>
                        <div class="action-title">My Requests</div>
                    </a>
                </div>

                <button id="btn-logout" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Log Out
                </button>

            </div>

        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA1eQbrJpH9OtDNDN7z9oTFTRSAE7vCFbg",
            authDomain: "afit-market-auth.firebaseapp.com",
            projectId: "afit-market-auth",
            storageBucket: "afit-market-auth.firebasestorage.app",
            messagingSenderId: "894920886640",
            appId: "1:894920886640:web:77d0a6b39bf89ff8f767b5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        const loginView = document.getElementById('login-view');
        const userArea = document.getElementById('user-area');
        const btnLogin = document.getElementById('btn-login');
        const btnLogout = document.getElementById('btn-logout');
        
        const userPic = document.getElementById('user-pic');
        const userName = document.getElementById('user-name');
        const userEmail = document.getElementById('user-email');

        // 1. HANDLE LOGIN
        btnLogin.addEventListener('click', () => {
            signInWithPopup(auth, provider)
                .then((result) => { console.log("Logged in"); })
                .catch((error) => { alert("Login failed: " + error.message); });
        });

        // 2. HANDLE LOGOUT
        btnLogout.addEventListener('click', () => {
            if(confirm("Are you sure you want to log out?")) {
                signOut(auth).then(() => { console.log("User signed out"); });
            }
        });

        // 3. MONITOR AUTH STATE
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginView.style.display = 'none';
                userArea.style.display = 'block';
                
                userName.innerText = user.displayName;
                userEmail.innerText = user.email;
                userPic.src = user.photoURL || "img/person.png";
            } else {
                loginView.style.display = 'block';
                userArea.style.display = 'none';
            }
        });
    </script>

</body>
</html>